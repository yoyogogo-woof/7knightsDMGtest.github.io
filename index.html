<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>傷害計算機</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background-color: #f9fafb;
      color: #111827;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #2563eb;
      margin-top: 20px;
    }
    .input-group {
      margin: 12px 0;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 4px;
    }
    input {
      width: 100%;
      padding: 8px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }
    #result {
      margin-top: 24px;
      font-size: 20px;
      font-weight: bold;
      color: #111827;
      text-align: center;
    }
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      h1 {
        font-size: 22px;
      }
      input {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <h1>傷害計算機</h1>

  <div class="input-group"><label>面板攻擊力</label><input type="number" id="atkPanel" value="0"></div>
  <div class="input-group"><label>基礎攻擊力</label><input type="number" id="atkBase" value="0"></div>
  <div class="input-group"><label>陣型攻%</label><input type="number" id="formAtk" value="0"></div>
  <div class="input-group"><label>寵物潛能攻%</label><input type="number" id="petAtkPercent" value="0"></div>
  <div class="input-group"><label>寵物攻擊力</label><input type="number" id="petAtkFlat" value="0"></div>
  <div class="input-group"><label>Buff加攻%</label><input type="number" id="buffAtk" value="0"></div>
  <div class="input-group"><label>寵物技能加攻%</label><input type="number" id="petSkillAtk" value="0"></div>
  //即時顯示總攻擊力
  <div class="input-group"><label>招式倍率%</label><input type="number" id="skillRate" value="100"></div>
  <div class="input-group"><label>暴擊傷害%</label><input type="number" id="critDmg" value="0"></div>
  <div class="input-group"><label>弱點傷害%</label><input type="number" id="weakDmg" value="0"></div>
  <div class="input-group"><label>復仇套增傷%</label><input type="number" id="revengeDmg" value="0"></div>
  <div class="input-group"><label>敵方防禦力</label><input type="number" id="enemyDef" value="0"></div>

  <div id="result">請輸入數值</div>

  <script>
    const fields = [
      'atkPanel', 'atkBase', 'formAtk', 'petAtkPercent', 'petAtkFlat',
      'buffAtk', 'petSkillAtk', 'skillRate', 'critDmg', 'weakDmg', 'revengeDmg', 'enemyDef'
    ];

    // 初始化：從 localStorage 載入舊資料
    window.onload = () => {
      fields.forEach(id => {
        const saved = localStorage.getItem(id);
        if (saved !== null) document.getElementById(id).value = saved;
      });
      calculate();
    };

    // 自動儲存與即時計算
    fields.forEach(id => {
      document.getElementById(id).addEventListener('input', () => {
        const val = document.getElementById(id).value;
        localStorage.setItem(id, val);
        calculate();
      });
    });

    function calculate() {
      const v = id => parseFloat(document.getElementById(id).value) || 0;

      const atkPanel = v('atkPanel');
      const atkBase = v('atkBase');
      const formAtk = v('formAtk') / 100;
      const petAtkPercent = v('petAtkPercent') / 100;
      const petAtkFlat = v('petAtkFlat');
      const buffAtk = v('buffAtk') / 100;
      const petSkillAtk = v('petSkillAtk') / 100;
      const skillRate = v('skillRate') / 100;
      const critDmg = v('critDmg') / 100;
      const weakDmg = v('weakDmg') / 100;
      const revengeDmg = v('revengeDmg') / 100;
      const enemyDef = v('enemyDef');

      const defRate = 1 - (enemyDef / (467 + enemyDef));

      const dmg = (
      (
        atkPanel +
        (atkBase * (formAtk + petAtkPercent)) +
        petAtkFlat
      ) *
      (1 + buffAtk + petSkillAtk)
        ) *
      skillRate *
      (1 + critDmg) *
      (1 + weakDmg) *
      (1 + revengeDmg) *
      defRate;

      document.getElementById('result').innerText = `最終傷害：${Math.round(dmg).toLocaleString()}`;
    }
  </script>
</body>
</html>

